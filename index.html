<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">
    <title>Luxury Blackjack</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark body {
            background: #1a1a1a !important;
            color: #e1e3e2 !important;
        }
        .light body {
            background: #f4f4f4 !important;
            color: #333 !important;
        }
        .card {
            width: 100px;
            height: 150px;
            background-size: 1300px 800px;
            background-image: url('https://math.hws.edu/eck/cs271/js-work/cards.png');
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease-in-out;
            position: relative;
        }
        .card.face-down {
            background: url('https://via.placeholder.com/100x150/660000/ffffff?text=Back') no-repeat center;
            background-size: cover;
        }
        .card:hover {
            transform: scale(1.05);
        }
        .animate-deal {
            animation: slideIn 0.5s ease-in-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .button {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
        }
    </style>
</head>
<body class="dark">
    <div class="container mx-auto p-4 max-w-4xl">
        <button id="themeToggle" class="theme-toggle bg-gray-700 text-white px-4 py-2 rounded">Toggle Theme</button>
        <div class="bg-green-900 p-8 rounded-lg shadow-lg relative">
            <h2 class="text-2xl text-green-200 mb-4">Dealer's Cards</h2>
            <div class="flex space-x-4 mb-8">
                <div id="dealer1" class="card"></div>
                <div id="dealer2" class="card"></div>
                <div id="dealer3" class="card"></div>
                <div id="dealer4" class="card"></div>
                <div id="dealer5" class="card"></div>
            </div>
            <h2 class="text-2xl text-green-200 mb-4">Your Cards</h2>
            <div class="flex space-x-4 mb-8">
                <div id="player1" class="card"></div>
                <div id="player2" class="card"></div>
                <div id="player3" class="card"></div>
                <div id="player4" class="card"></div>
                <div id="player5" class="card"></div>
            </div>
            <div class="flex justify-between items-center">
                <div>
                    <span class="text-xl text-yellow-300">You have: </span>
                    <span id="money" class="text-2xl text-yellow-300">$100</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-green-200">Your bet:</span>
                    <input type="text" id="bet" class="w-20 p-2 rounded bg-gray-800 text-white" value="10">
                </div>
            </div>
        </div>
        <div class="mt-4 flex justify-center space-x-4">
            <button id="hitButton" class="button bg-blue-600 text-white" disabled>Hit</button>
            <button id="standButton" class="button bg-blue-600 text-white" disabled>Stand</button>
            <button id="newGameButton" class="button bg-green-600 text-white">New Game</button>
        </div>
        <div id="message" class="text-center mt-4 text-red-600 font-bold">
            Welcome to Luxury Blackjack!<br>Click "New Game" to Begin.
        </div>
    </div>

    <audio id="dealSound" src="https://www.soundjay.com/buttons/button-3.mp3"></audio>

    <script>
        // Deck and Card Classes (Simplified from assumed Card.js and DisplayedCard.js)
        class Card {
            constructor(suit, value) {
                this.suit = suit;
                this.value = value;
            }
        }

        class Deck {
            constructor() {
                this.cards = [];
                const suits = ['H', 'D', 'C', 'S'];
                for (let suit of suits) {
                    for (let value = 1; value <= 13; value++) {
                        this.cards.push(new Card(suit, value));
                    }
                }
            }
            shuffle() {
                for (let i = this.cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
                }
            }
            nextCard() {
                return this.cards.pop();
            }
        }

        class DisplayedCard {
            constructor(elementId) {
                this.cardContainer = document.getElementById(elementId);
                this.faceDown = false;
            }
            setCard(card) {
                this.card = card;
                if (!this.faceDown) {
                    const suitOffset = { 'H': 0, 'D': 1, 'C': 2, 'S': 3 };
                    const x = -79 * (card.value - 1);
                    const y = -123 * suitOffset[card.suit];
                    this.cardContainer.style.backgroundPosition = `${x}px ${y}px`;
                }
            }
            setFaceDown() {
                this.faceDown = true;
                this.cardContainer.classList.add('face-down');
            }
            setFaceUp() {
                this.faceDown = false;
                this.cardContainer.classList.remove('face-down');
            }
        }

        // Game Logic
        let dealerCards = [];
        let playerCards = [];
        dealerCards.count = 0;
        playerCards.count = 0;
        let deck = new Deck();
        let gameInProgress = false;
        let bet, money = 100, moneyDisplay, betInput, message;
        let standButton, hitButton, newGameButton;

        function setup() {
            for (let i = 1; i <= 5; i++) {
                dealerCards[i] = new DisplayedCard(`dealer${i}`);
                dealerCards[i].cardContainer.style.display = 'none';
                playerCards[i] = new DisplayedCard(`player${i}`);
                playerCards[i].cardContainer.style.display = 'none';
            }
            message = document.getElementById('message');
            standButton = document.getElementById('standButton');
            hitButton = document.getElementById('hitButton');
            newGameButton = document.getElementById('newGameButton');
            moneyDisplay = document.getElementById('money');
            betInput = document.getElementById('bet');
            moneyDisplay.innerHTML = `$${money}`;
            betInput.value = 10;
            betInput.disabled = false;
            standButton.disabled = true;
            hitButton.disabled = true;
            newGameButton.disabled = false;

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark');
                document.body.classList.toggle('light');
            });
        }

        function dealCard(cards, runOnFinish, faceDown) {
            const crd = deck.nextCard();
            cards.count++;
            if (faceDown) cards[cards.count].setFaceDown();
            else cards[cards.count].setFaceUp();
            cards[cards.count].setCard(crd);
            cards[cards.count].cardContainer.style.display = 'block';
            cards[cards.count].cardContainer.classList.add('animate-deal');
            document.getElementById('dealSound').play();
            setTimeout(() => {
                cards[cards.count].cardContainer.classList.remove('animate-deal');
                if (runOnFinish) runOnFinish();
            }, 500);
        }

        function getTotal(hand) {
            let total = 0, ace = false;
            for (let i = 1; i <= hand.count; i++) {
                total += Math.min(10, hand[i].card.value);
                if (hand[i].card.value === 1) ace = true;
            }
            if (total + 10 <= 21 && ace) total += 10;
            return total;
        }

        function startGame() {
            if (!gameInProgress) {
                const betText = betInput.value;
                if (!betText.match(/^[0-9]+$/) || betText < 1 || betText > money) {
                    message.innerHTML = `Bet must be a number between 1 and ${money}.<br>Fix this problem and press New Game again.`;
                    betInput.classList.add('animate-pulse');
                    setTimeout(() => betInput.classList.remove('animate-pulse'), 1000);
                    return;
                }
                betInput.disabled = true;
                bet = Number(betText);
                for (let i = 1; i <= 5; i++) {
                    playerCards[i].cardContainer.style.display = 'none';
                    playerCards[i].setFaceDown();
                    dealerCards[i].cardContainer.style.display = 'none';
                    dealerCards[i].setFaceDown();
                }
                message.innerHTML = 'Dealing Cards...';
                deck.shuffle();
                dealerCards.count = 0;
                playerCards.count = 0;
                dealCard(playerCards, () => {
                    dealCard(dealerCards, () => {
                        dealCard(playerCards, () => {
                            dealCard(dealerCards, () => {
                                standButton.disabled = false;
                                hitButton.disabled = false;
                                newGameButton.disabled = true;
                                gameInProgress = true;
                                const dealerTotal = getTotal(dealerCards);
                                const playerTotal = getTotal(playerCards);
                                if (dealerTotal === 21) {
                                    endGame(playerTotal === 21 ? false : false, playerTotal === 21 ? 'You both have Blackjack, but dealer wins on ties.' : 'Dealer has Blackjack.');
                                } else if (playerTotal === 21) {
                                    endGame(true, 'You have Blackjack!');
                                } else {
                                    message.innerHTML = `You have ${playerTotal}. Hit or Stand?`;
                                }
                            }, true);
                        });
                    });
                });
            }
        }

        function endGame(win, why) {
            if (win) money += bet;
            else money -= bet;
            message.innerHTML = `${win ? 'Congratulations! You win.' : 'Sorry! You lose.'} ${why} ${money > 0 ? '<br>Click New Game to play again.' : '<br>Looks like you\'ve run out of money!'}`;
            standButton.disabled = true;
            hitButton.disabled = true;
            newGameButton.disabled = true;
            gameInProgress = false;
            if (dealerCards[2].faceDown) {
                dealerCards[2].cardContainer.style.display = 'none';
                dealerCards[2].setFaceUp();
                dealerCards[2].cardContainer.style.display = 'block';
                dealerCards[2].cardContainer.classList.add('animate-deal');
                setTimeout(() => dealerCards[2].cardContainer.classList.remove('animate-deal'), 500);
            }
            moneyDisplay.classList.add('opacity-0');
            setTimeout(() => {
                moneyDisplay.innerHTML = `$${money}`;
                moneyDisplay.classList.remove('opacity-0');
                moneyDisplay.classList.add('opacity-100');
                if (money <= 0) {
                    betInput.value = 'BUSTED';
                    moneyDisplay.classList.add('animate-pulse');
                    setTimeout(() => moneyDisplay.classList.remove('animate-pulse'), 1000);
                } else {
                    if (bet > money) betInput.value = money;
                    standButton.disabled = true;
                    hitButton.disabled = true;
                    newGameButton.disabled = false;
                    betInput.disabled = false;
                }
            }, 500);
        }

        function dealersTurnAndEndGame() {
            message.innerHTML = "Dealer's turn...";
            dealerCards[2].cardContainer.style.display = 'none';
            dealerCards[2].setFaceUp();
            const takeNextCardOrFinish = () => {
                dealerCards[2].cardContainer.style.display = 'block';
                dealerCards[2].cardContainer.classList.add('animate-deal');
                setTimeout(() => {
                    dealerCards[2].cardContainer.classList.remove('animate-deal');
                    const dealerTotal = getTotal(dealerCards);
                    if (dealerCards.count < 5 && dealerTotal <= 16) {
                        dealerCards.count++;
                        dealerCards[dealerCards.count].setCard(deck.nextCard());
                        dealerCards[dealerCards.count].setFaceUp();
                        dealCard(dealerCards, takeNextCardOrFinish);
                    } else if (dealerTotal > 21) {
                        endGame(true, 'Dealer has gone over 21.');
                    } else if (dealerCards.count === 5) {
                        endGame(false, 'Dealer took 5 cards without going over 21.');
                    } else {
                        const playerTotal = getTotal(playerCards);
                        if (playerTotal > dealerTotal) {
                            endGame(true, `You have ${playerTotal}. Dealer has ${dealerTotal}.`);
                        } else if (playerTotal < dealerTotal) {
                            endGame(false, `You have ${playerTotal}. Dealer has ${dealerTotal}.`);
                        } else {
                            endGame(false, `You and the dealer are tied at ${playerTotal}.`);
                        }
                    }
                }, 500);
            };
            takeNextCardOrFinish();
        }

        function hit() {
            if (!gameInProgress) return;
            standButton.disabled = true;
            hitButton.disabled = true;
            dealCard(playerCards, () => {
                const playerTotal = getTotal(playerCards);
                if (playerTotal > 21) {
                    endGame(false, 'YOU WENT OVER 21!');
                } else if (playerCards.count === 5) {
                    endGame(true, 'You took 5 cards without going over 21.');
                } else if (playerTotal === 21) {
                    dealersTurnAndEndGame();
                } else {
                    message.innerHTML = `You have ${playerTotal}. Hit or Stand?`;
                    hitButton.disabled = false;
                    standButton.disabled = false;
                }
            });
        }

        function stand() {
            if (!gameInProgress) return;
            hitButton.disabled = true;
            standButton.disabled = true;
            dealersTurnAndEndGame();
        }

        window.onload = setup;
    </script>
</body>
  </html>
